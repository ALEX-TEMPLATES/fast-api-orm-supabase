# 05. Использование `Makefile` для Управления Проектом

`Makefile` в корне проекта предоставляет набор удобных команд для автоматизации часто выполняемых задач, в частности, для управления миграциями базы данных с помощью Alembic.

## Основные Команды

Все команды `make` следует выполнять из корневой директории вашего проекта (`/home/am/projects/03_templates/fast-api-naive-no-orm/`).

### 1. Получение Справки

```bash
make help
```

Эта команда выведет список всех доступных целей (команд) в `Makefile` с кратким описанием и примерами их использования.

### 2. Создание Новой Миграции (`mm`)

```bash
make mm "ваше_сообщение_о_миграции"
```

*   **Назначение:** Создает новый файл ревизии Alembic с использованием функции автогенерации. Alembic сравнит текущее состояние ваших моделей SQLAlchemy (определенных в `src/app/schemas/`) со схемой в базе данных и сгенерирует DDL-инструкции для приведения базы данных в соответствие с моделями.
*   **Аргумент:** Сообщение для миграции, описывающее изменения. Если сообщение состоит из нескольких слов, его **необходимо** заключить в кавычки.
*   **Пример:**
    ```bash
    make mm "add_description_to_example_table"
    ```
*   **Что происходит "под капотом":**
    1.  Команда `cd src` переходит в директорию `src/`.
    2.  Выполняется `alembic revision -m "ваше_сообщение_о_миграции" --autogenerate`.
    3.  Новый файл миграции создается в `src/alembic/versions/`.
*   **Важно:** После создания миграции всегда проверяйте содержимое сгенерированного файла, чтобы убедиться, что он содержит ожидаемые изменения.

**Механизм передачи сообщения:**
В `Makefile` используется переменная `ARGS = $(filter-out $@,$(MAKECMDGOALS))` для захвата всех аргументов, переданных команде `make mm` после самого имени `mm`. Это позволяет передавать сообщение о миграции более естественным образом, без необходимости указывать имя переменной (например, `MESSAGE=`). `ifeq ($(strip $(ARGS)),)` проверяет, что сообщение было предоставлено.

### 3. Применение Миграций (`uh`)

```bash
make uh
```

*   **Назначение:** Применяет все ожидающие миграции к базе данных, обновляя схему до последней доступной ревизии (`head`).
*   **Что происходит "под капотом":**
    1.  Команда `cd src` переходит в директорию `src/`.
    2.  Выполняется `alembic upgrade head`.
*   **Важно:** Убедитесь, что ваша база данных запущена и доступна перед выполнением этой команды.

## Расширение `Makefile`

При необходимости вы можете добавлять в `Makefile` новые цели для автоматизации других рутинных задач, таких как запуск тестов, сборка документации, линтинг кода и т.д. Это помогает стандартизировать рабочие процессы в проекте.
